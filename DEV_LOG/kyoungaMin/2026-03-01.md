# 개발일지 — 2026-03-01 (Day 1)

> **작성자**: kyoungaMin (kamin@penta.co.kr)
> **프로젝트**: 반도체 부품·소재 수요예측 AI SaaS

---

## 작업 목표
- Phase 3 리스크 스코어링(S5/S6) 실데이터 검증, 가중치 조정, 등급 분포 확인, 조치 큐 실효성 검토
- Phase 4 생산·발주 최적화 알고리즘 개발 (S7 생산계획 + S8 발주추천 + S6 보강)

## 작업 내역

| 시간 | 작업 내용 | 카테고리 | 상태 |
|------|----------|----------|------|
| - | S5/S6 파이프라인 실행 및 검증 스크립트(validate_risk.py) 작성 | `모델링` | `완료` |
| - | 등급 경계(RISK_GRADE_BOUNDS) 갭 버그 수정 — (0,20)/(21,40) 사이 0.5단위 누락 → 연속 구간 방식 변경 | `버그수정` | `완료` |
| - | 과잉 리스크: 수요 없는 제품 monthly_demand=1 폴백 제거 → 재고 유무 기반 고정 30점 | `모델링` | `완료` |
| - | 납기 리스크: 시작점 70→40/70(납기초과) 분리, 단계적 스케일링 | `모델링` | `완료` |
| - | S6 심각도: 개별점수×종합점수 조합 로직 도입, critical 66%→3% 개선 | `모델링` | `완료` |
| - | risk_score UPSERT on_conflict 누락 수정 | `버그수정` | `완료` |
| - | action_queue 중복 생성 방지(같은 날짜 pending 삭제 후 재생성) | `버그수정` | `완료` |
| - | Phase 4 DDL 작성 (16_optimization_ddl.sql) — production_plan, purchase_recommendation 2테이블 | `데이터` | `완료` |
| - | S7 생산 최적화 모듈 구현 — 수요예측+재고+캐파+리스크 기반 제품별 최적 생산량 산출 | `모델링` | `완료` |
| - | S8 발주 최적화 모듈 구현 — BOM 전개+EOQ/ROP+공급사 가중점수 기반 발주추천 | `모델링` | `완료` |
| - | run_pipeline.py에 S7/S8 등록, config.py에 Phase 4 상수 추가 | `세팅` | `완료` |
| - | S6 action_queue 보강 — S7/S8 결과 연동하여 suggested_qty 정교화 | `리팩토링` | `완료` |
| - | README 마일스톤·구조·파이프라인 문서 업데이트 | `문서` | `완료` |
| - | DDL 적용 확인 (production_plan, purchase_recommendation) | `데이터` | `완료` |
| - | S7 생산 최적화 파이프라인 실행 — 3,562건 생산계획 산출 (56.6s) | `모델링` | `완료` |
| - | S8 발주 최적화 파이프라인 실행 — 1,356건 발주추천 산출 (27.4s) | `모델링` | `완료` |
| - | S7/S8 결과 무결성 검증 — 음수 없음, 일정 정합성 통과, JSON 유효 | `테스트` | `완료` |
| - | 고객사 제안서 PPT 생성 (15슬라이드) — 방향·방법론·검증결과·로드맵 종합 | `문서` | `완료` |

> **카테고리**: `세팅` `데이터` `모델링` `백엔드` `프론트` `인프라` `테스트` `문서` `리팩토링` `버그수정` `회의`

## 산출물
- `DB/07_pipeline/validate_risk.py` — 리스크 스코어링 검증 리포트 스크립트
- `DB/07_pipeline/s5_risk_score.py` — 수정 (과잉/납기 로직, on_conflict)
- `DB/07_pipeline/s6_action_queue.py` — 수정 (심각도 로직, 중복 방지, S7/S8 연동 보강)
- `DB/07_pipeline/config.py` — 수정 (RISK_GRADE_BOUNDS 연속 구간, Phase 4 상수 추가)
- `DB/16_optimization_ddl.sql` — 신규 (production_plan, purchase_recommendation DDL)
- `DB/07_pipeline/s7_production_plan.py` — 신규 (생산 최적화 모듈)
- `DB/07_pipeline/s8_purchase_optimization.py` — 신규 (발주 최적화 모듈)
- `DB/07_pipeline/run_pipeline.py` — 수정 (S7/S8 스텝 등록)
- `AI_수요예측_SaaS_제안서.pptx` — 신규 (고객사 제안서 15슬라이드)
- `generate_proposal_ppt.py` — 신규 (PPT 생성 스크립트)

## 이슈/블로커
- A등급 76.6% 편중: 13,321개 제품 중 ~83%가 최근 90일 수요 이력 없음 → 수요 없으면 리스크 자체가 낮으므로 데이터 특성상 정상. 비활성 제품 필터링 별도 고려 필요.

## 의사결정 기록

| 결정 사항 | 선택지 | 결정 | 사유 |
|-----------|--------|------|------|
| 수요 0 제품 과잉 리스크 | ①무조건 0 ②고정 경고 30 ③재고금액 비례 | ②고정 30 | 재고가 존재하는데 수요 없으면 경고는 필요하나 개별 판정보다 단순 경고가 적절 |
| 등급 경계 방식 | ①범위 튜플 ②상한값 리스트 | ②상한값 | 정수 사이 갭(20.5) 버그 방지 |
| S6 심각도 산정 | ①개별점수만 ②종합점수만 ③개별×종합 조합 | ③조합 | critical을 진정한 위험에만 한정, 우선순위 실행력 확보 |
| S7 생산량 산출 기준 | ①P50만 ②P90만 ③리스크별 동적 | ③동적 | 결품 위험 시 P90 상향, 과잉 위험 시 10% 감량 |
| S8 발주량 산출 | ①lot-for-lot만 ②EOQ만 ③EOQ+fallback | ③EOQ+fallback | EOQ 불가 시(단가 0 등) lot-for-lot 자동 전환 |
| 공급사 추천 가중치 | ①단가 위주 ②리드타임 위주 ③종합 점수 | ③종합(리드0.4+단가0.35+신뢰0.25) | 단일 기준 편향 방지, 대체 공급사도 함께 제시 |

## 검증 결과 요약

### 수정 전→후 비교

| 항목 | 수정 전 | 수정 후 |
|------|---------|---------|
| 과잉 리스크 평균 | 59.1 | 24.1 |
| B등급 집중 | 57.4% | 11.7% |
| 조치 critical | 66.5% | 2.9% |
| 조치 high | 33.0% | 74.4% |
| 조치 medium | 0.5% | 22.8% |
| 커버리지 (C+) | 99.3% | 100% |

### 최종 등급 분포
A: 10,199 (76.6%) / B: 1,564 (11.7%) / C: 1,512 (11.4%) / D: 46 (0.3%) / F: 0

### 최종 조치 큐 심각도
critical: 91 (2.9%) / high: 2,350 (74.4%) / medium: 720 (22.8%)

## S7/S8 실행 결과

### S7 생산 최적화 (production_plan)
| 항목 | 값 |
|------|-----|
| 총 건수 | 3,562행 |
| 우선순위 | critical 2,125 / high 27 / medium 33 / low 1,377 |
| 계획유형 | increase 981 / decrease 824 / maintain 452 / new 1,305 |
| planned_qty=0 | 935건 (수요+안전재고 ≤ 재고 → 추가 생산 불필요) |
| 소요시간 | 56.6s |

### S8 발주 최적화 (purchase_recommendation)
| 항목 | 값 |
|------|-----|
| 총 건수 | 1,356행 |
| 긴급도 | critical 1,220 / high 120 / medium 15 / low 1 |
| 발주방식 | lot_for_lot 1,218 / EOQ 138 |
| 공급사 매핑율 | 11.7% (159/1,356) |
| 소요시간 | 27.4s |

### 무결성 검증
- planned_qty < 0: **0건** (정상)
- recommended_qty < 0: **0건** (정상)
- latest_order_date ≤ need_date: **50/50** 샘플 통과
- parent_product_ids JSON 유효: **20/20** 샘플 통과
- planned_qty=0 & critical: **2건** (재고가 부족하지만 캐파/수요 조건으로 0 산출 — 별도 확인 필요)

### 관찰 사항
- **critical 60%**: S7에서 3,562건 중 2,125건(60%)이 critical → risk_score에서 F/D 등급 또는 결품위험≥80인 제품이 다수
- **공급사 매핑율 11.7%**: 발주이력이 있는 자재만 공급사 추천 가능 → 나머지는 수동 매핑 필요
- **new 유형 1,305건**: 최근 90일 생산 이력 없는 제품 → 캐파 기준선 없이 수요 기반 계획
- **lot_for_lot 89.8%**: 대다수 자재가 단가 정보 부족으로 EOQ 불가 → 순소요량 기반 발주

## 내일 할 일
- [x] S7/S8 파이프라인 실행 및 결과 검증
- [ ] 비활성 제품(수요 0) 필터링 옵션 검토
- [ ] Phase 5 웹 대시보드 및 API 서버 구축 착수

## 메모
- 가중치 민감도 분석: 모든 시나리오에서 C이상 비율 11~16% 유지 → 현재 가중치(결품 0.35/과잉 0.25/납기 0.25/마진 0.15) 안정적
- 재고일수 분포에서 93% < 7일은 월별 재고 스냅샷 vs 일별 수요의 시간 불일치 때문일 가능성 있음
