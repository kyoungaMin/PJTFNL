# 개발일지 — 2026-03-01 (Day 1)

> **작성자**: kyoungaMin (kamin@penta.co.kr)
> **프로젝트**: 반도체 부품·소재 수요예측 AI SaaS

---

## 작업 목표
- Phase 3 리스크 스코어링(S5/S6) 실데이터 검증, 가중치 조정, 등급 분포 확인, 조치 큐 실효성 검토

## 작업 내역

| 시간 | 작업 내용 | 카테고리 | 상태 |
|------|----------|----------|------|
| - | S5/S6 파이프라인 실행 및 검증 스크립트(validate_risk.py) 작성 | `모델링` | `완료` |
| - | 등급 경계(RISK_GRADE_BOUNDS) 갭 버그 수정 — (0,20)/(21,40) 사이 0.5단위 누락 → 연속 구간 방식 변경 | `버그수정` | `완료` |
| - | 과잉 리스크: 수요 없는 제품 monthly_demand=1 폴백 제거 → 재고 유무 기반 고정 30점 | `모델링` | `완료` |
| - | 납기 리스크: 시작점 70→40/70(납기초과) 분리, 단계적 스케일링 | `모델링` | `완료` |
| - | S6 심각도: 개별점수×종합점수 조합 로직 도입, critical 66%→3% 개선 | `모델링` | `완료` |
| - | risk_score UPSERT on_conflict 누락 수정 | `버그수정` | `완료` |
| - | action_queue 중복 생성 방지(같은 날짜 pending 삭제 후 재생성) | `버그수정` | `완료` |

> **카테고리**: `세팅` `데이터` `모델링` `백엔드` `프론트` `인프라` `테스트` `문서` `리팩토링` `버그수정` `회의`

## 산출물
- `DB/07_pipeline/validate_risk.py` — 리스크 스코어링 검증 리포트 스크립트
- `DB/07_pipeline/s5_risk_score.py` — 수정 (과잉/납기 로직, on_conflict)
- `DB/07_pipeline/s6_action_queue.py` — 수정 (심각도 로직, 중복 방지)
- `DB/07_pipeline/config.py` — 수정 (RISK_GRADE_BOUNDS 연속 구간)

## 이슈/블로커
- A등급 76.6% 편중: 13,321개 제품 중 ~83%가 최근 90일 수요 이력 없음 → 수요 없으면 리스크 자체가 낮으므로 데이터 특성상 정상. 비활성 제품 필터링 별도 고려 필요.

## 의사결정 기록

| 결정 사항 | 선택지 | 결정 | 사유 |
|-----------|--------|------|------|
| 수요 0 제품 과잉 리스크 | ①무조건 0 ②고정 경고 30 ③재고금액 비례 | ②고정 30 | 재고가 존재하는데 수요 없으면 경고는 필요하나 개별 판정보다 단순 경고가 적절 |
| 등급 경계 방식 | ①범위 튜플 ②상한값 리스트 | ②상한값 | 정수 사이 갭(20.5) 버그 방지 |
| S6 심각도 산정 | ①개별점수만 ②종합점수만 ③개별×종합 조합 | ③조합 | critical을 진정한 위험에만 한정, 우선순위 실행력 확보 |

## 검증 결과 요약

### 수정 전→후 비교

| 항목 | 수정 전 | 수정 후 |
|------|---------|---------|
| 과잉 리스크 평균 | 59.1 | 24.1 |
| B등급 집중 | 57.4% | 11.7% |
| 조치 critical | 66.5% | 2.9% |
| 조치 high | 33.0% | 74.4% |
| 조치 medium | 0.5% | 22.8% |
| 커버리지 (C+) | 99.3% | 100% |

### 최종 등급 분포
A: 10,199 (76.6%) / B: 1,564 (11.7%) / C: 1,512 (11.4%) / D: 46 (0.3%) / F: 0

### 최종 조치 큐 심각도
critical: 91 (2.9%) / high: 2,350 (74.4%) / medium: 720 (22.8%)

## 내일 할 일
- [ ] 비활성 제품(수요 0) 필터링 옵션 검토
- [ ] 가중치 민감도 결과 기반 최적 가중치 결정 회의
- [ ] 프론트엔드 리스크 대시보드 연동 준비

## 메모
- 가중치 민감도 분석: 모든 시나리오에서 C이상 비율 11~16% 유지 → 현재 가중치(결품 0.35/과잉 0.25/납기 0.25/마진 0.15) 안정적
- 재고일수 분포에서 93% < 7일은 월별 재고 스냅샷 vs 일별 수요의 시간 불일치 때문일 가능성 있음
