# 개발일지 — 2026-02-28 (Day 2)

> **작성자**: kyoungaMin (kamin@penta.co.kr)
> **프로젝트**: 반도체 부품·소재 수요예측 AI SaaS

---

## 작업 목표
- 예측형 관제(Control Tower) 시스템 DB 스키마 설계 및 데이터 파이프라인 구축
- 매출 데이터를 출하 프록시로 사용, 일간 추정 재고 산출 로직 구현

## 작업 내역

| 시간 | 작업 내용 | 카테고리 | 상태 |
|------|----------|----------|------|
| — | GitHub 리포 멤버 공유 설정 안내 | `세팅` | `완료` |
| — | Supabase Organization 이전 (프로젝트 공유용) | `세팅` | `완료` |
| — | 예측형 관제 시스템 요건 vs 현재 데이터 충족 분석 | `데이터` | `완료` |
| — | 분석용 DDL 설계 (6테이블) — `06_analytics_ddl.sql` | `데이터` | `완료` |
| — | 파이프라인 공통 config 모듈 작성 | `데이터` | `완료` |
| — | S1: 일간 추정 재고 계산 파이프라인 | `데이터` | `완료` |
| — | S2: 제품별 리드타임 통계 산출 파이프라인 | `데이터` | `완료` |
| — | S3: 피처 엔지니어링 파이프라인 (내부 ERP + 외부지표 조인) | `데이터` | `완료` |
| — | S4: 수요예측 모델 파이프라인 (LightGBM Quantile / 이동평균 fallback) | `모델링` | `완료` |
| — | S5: 리스크 스코어링 파이프라인 (결품/과잉/납기/마진) | `모델링` | `완료` |
| — | S6: 조치 큐 생성 파이프라인 (권장 조치 자동 생성) | `모델링` | `완료` |
| — | 파이프라인 통합 실행기 작성 | `데이터` | `완료` |
| — | SCHEMA_REFERENCE.md 업데이트 (분석 테이블 6개 추가) | `문서` | `완료` |
| — | 월별 집계 쿼리 SQL 작성 (7종) — `07_queries/monthly_aggregation.sql` | `데이터` | `완료` |
| — | 주별·월별 집계 DDL 설계 (4테이블) — `08_aggregation_ddl.sql` | `데이터` | `완료` |
| — | S0: 주별·월별 집계 파이프라인 — `s0_aggregation.py` | `데이터` | `완료` |
| — | run_pipeline.py에 step 0 추가 | `데이터` | `완료` |
| — | SCHEMA_REFERENCE.md 업데이트 (집계 테이블 4개 추가, 23테이블 체계) | `문서` | `완료` |
| — | 환율 테이블 DDL 설계 — `09_exchange_rate_ddl.sql` | `데이터` | `완료` |
| — | 환율 데이터 생성/적재 스크립트 — `10_load_exchange_rate.py` | `데이터` | `완료` |
| — | 환율 데이터 적재 (USD/JPY/EUR/CNY → KRW, 5,321건) | `데이터` | `완료` |
| — | SCHEMA_REFERENCE.md 업데이트 (exchange_rate 테이블 추가, 25테이블 체계) | `문서` | `완료` |
| — | 반도체 산업 외부 지수 데이터 생성 스크립트 — `11_load_indices.py` | `데이터` | `완료` |
| — | 외부 지수 10종 적재 (SOX/DRAM/NAND/웨이퍼/BDI/구리/한국금리·CPI·IPI/중국PMI, 4,886건) | `데이터` | `완료` |
| — | SCHEMA_REFERENCE.md 업데이트 (외부 지수 10종 문서화) | `문서` | `완료` |
| — | README.md 작성 (프로젝트 전체 설명서, 제안서 기반) | `문서` | `완료` |

> **카테고리**: `세팅` `데이터` `모델링` `백엔드` `프론트` `인프라` `테스트` `문서` `리팩토링` `버그수정` `회의`

## 산출물
- `DB/06_analytics_ddl.sql` — 분석용 DDL (6테이블: daily_inventory_estimated, product_lead_time, feature_store, forecast_result, risk_score, action_queue)
- `DB/07_pipeline/config.py` — 파이프라인 공통 설정 (Supabase 연결, 배치 UPSERT, 리스크 가중치)
- `DB/07_pipeline/s1_daily_inventory.py` — 일간 추정 재고 산출 (월초 스냅샷 + 누적생산 - 누적출하)
- `DB/07_pipeline/s2_lead_time.py` — 리드타임 통계 (AVG/MED/P90/MIN/MAX)
- `DB/07_pipeline/s3_feature_store.py` — 피처 엔지니어링 (롤링 윈도우 + 외부지표 forward-fill)
- `DB/07_pipeline/s4_forecast.py` — 수요예측 모델 (LightGBM Quantile P10/P50/P90)
- `DB/07_pipeline/s5_risk_score.py` — 리스크 스코어링 (4유형 가중합, A~F 등급)
- `DB/07_pipeline/s6_action_queue.py` — 조치 큐 자동 생성 (C등급 이상)
- `DB/07_pipeline/run_pipeline.py` — 통합 실행기 (전체/스텝별 선택 실행)
- `DB/SCHEMA_REFERENCE.md` — 업데이트 (19테이블 체계)
- `DB/07_queries/monthly_aggregation.sql` — 월별 집계 쿼리 7종 (거래처별, 품목별, TOP 10, 점유율 등)
- `DB/08_aggregation_ddl.sql` — 주별·월별 집계 DDL (4테이블: weekly/monthly_product_summary, weekly/monthly_customer_summary)
- `DB/07_pipeline/s0_aggregation.py` — 주별·월별 집계 파이프라인 (수주+매출+생산 통합)
- `DB/SCHEMA_REFERENCE.md` — 업데이트 (23테이블 체계, 집계 테이블 추가)
- `DB/09_exchange_rate_ddl.sql` — 환율 DDL (exchange_rate 1테이블, 통화쌍별 일별 환율)
- `DB/10_load_exchange_rate.py` — 환율 데이터 생성/적재 (FRED API 실데이터 + 앵커 기반 생성)
- `DB/SCHEMA_REFERENCE.md` — 업데이트 (25테이블 체계, exchange_rate 추가)
- `DB/11_load_indices.py` — 반도체 산업 외부 지수 10종 생성/적재 (SOX, DRAM, NAND, 웨이퍼, BDI, 구리, 한국 금리·CPI·IPI, 중국 PMI)
- `DB/SCHEMA_REFERENCE.md` — 업데이트 (외부 지수 10종 문서화, economic_indicator ~8,475건)
- `README.md` — 프로젝트 전체 설명서 (배경, 핵심기능, 아키텍처, 파이프라인, 기술 스택, DB 구조, 목표, 로드맵)

## 이슈/블로커
- 없음

## 의사결정 기록

| 결정 사항 | 선택지 | 결정 | 사유 |
|-----------|--------|------|------|
| 출하 데이터 대체 | 별도 출하 테이블 / 매출 대체 | 매출(daily_revenue) 대체 | B2B 반도체 특성상 출하≈매출 래그 미미, 주간 집계 시 흡수 |
| 일간 재고 산출 | DB 뷰 / Python 계산 테이블 | Python 계산 → 테이블 적재 | 월초 스냅샷 기반 일간 보간, 복잡한 누적 로직 Python이 유연 |
| 예측 모델 | Prophet / ARIMA / LightGBM Quantile | LightGBM Quantile | P10/P50/P90 밴드 직접 산출, 외부 피처 활용 용이, 이동평균 fallback 포함 |
| 리스크 가중치 | 균등 / 불균등 | 불균등 (결품35%/과잉25%/납기25%/마진15%) | 제조업 특성상 결품 리스크가 가장 치명적 |
| 조치 큐 생성 기준 | 전체 / C등급 이상 | C등급 이상 (total_risk > 40) | 과다 알림 방지, 운영 실효성 |

## 내일 할 일
- [ ] Supabase SQL Editor에서 06_analytics_ddl.sql, 08_aggregation_ddl.sql 실행
- [ ] 파이프라인 실행 테스트 (step 0~6 순차)
- [ ] lightgbm 패키지 설치 및 모델 학습 검증
- [ ] 예측 결과 시각화 (P10/P50/P90 밴드 차트)

## 메모
- 파이프라인 실행 전 반드시 DDL을 Supabase SQL Editor에서 먼저 실행해야 함 (`06_analytics_ddl.sql` + `08_aggregation_ddl.sql`)
- lightgbm 미설치 시 이동평균 fallback으로 동작
- 리스크 가중치는 추후 운영 데이터 기반 튜닝 필요
- `daily_revenue.customer_id` → `supplier.customer_code` 매핑 (customer 테이블이 아님)
